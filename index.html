<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>INDOVP Demon List â€” Owner Mode</title>
<style>
  :root{--bg:#0f1720;--card:#111827;--accent:#2a6cf4;--ok:#22c55e;--bad:#ef4444;color:#e6eef6}
  body{background:var(--bg);color:var(--color,#e6eef6);font-family:Inter,Arial,Helvetica,sans-serif;padding:18px}
  h1{text-align:center;margin:6px 0 18px}
  .wrap{max-width:980px;margin:0 auto}
  input[type="text"], input[type="number"]{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.1);background:#0b1220;color:var(--color)}
  button{background:var(--accent);color:white;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.2)}
  .card{background:var(--card);padding:14px;border-radius:10px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,0.6)}
  .level-head{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .difficulty{padding:5px 8px;border-radius:6px;font-weight:700;color:#081223}
  .Easy{background:#34d399}
  .Medium{background:#60a5fa}
  .Hard{background:#fb923c}
  .Insane{background:#a78bfa}
  .Extreme{background:#f43f5e}
  ul{list-style:none;padding:0;margin:0}
  li.record{display:flex;justify-content:space-between;padding:8px;border-radius:6px;background:rgba(255,255,255,0.05);margin-bottom:6px}
  .pending-bubble{background:#f59e0b;color:#081223;padding:6px 10px;border-radius:999px;font-weight:700}
  .owner-panel{margin-top:12px;padding:12px;border-radius:10px;background:rgba(42,108,244,0.06)}
  .muted{opacity:0.7;font-size:13px}
  .smallbtn{padding:6px 8px;border-radius:6px;border:none;cursor:pointer}
  .approve{background:var(--ok);color:#021205}
  .reject{background:var(--bad);color:white}
  .owner-login-box{display:flex;justify-content:center;gap:10px;margin:20px 0}
</style>
</head>
<body>
<div class="wrap">
  <h1>INDOVP â€” Demon List</h1>

  <!-- Owner Login Bereich -->
  <div class="card">
    <h2 style="text-align:center;margin-bottom:12px">ðŸ”‘ Owner-Login</h2>
    <div class="owner-login-box">
      <input id="ownerCodeInput" type="text" placeholder="Owner-Code (z.B. 41342)" style="flex:1;max-width:300px;text-align:center;font-size:16px">
      <button id="ownerLoginBtn">Login</button>
      <button id="ownerLogoutBtn" class="ghost" style="display:none">Logout</button>
    </div>
    <div style="text-align:center;margin-top:8px">
      <span id="ownerBadge" style="display:none" class="pending-bubble">Owner-Mode ON</span>
    </div>
  </div>

  <div id="levelsContainer"></div>

  <div id="ownerPanel" class="card owner-panel" style="display:none">
    <h3>Owner â€” Pending-Fach</h3>
    <div id="pendingList" style="min-height:40px"></div>
    <div class="muted">Hier siehst du alle eingereichten Runs. Approve = Ã¶ffentlich, Reject = gelÃ¶scht.</div>
  </div>
</div>

<script>
/* ----- Levels eintragen ----- */
const levels = [
  { id: 101, name: "Bloodrush", creator: "CreatorA", difficulty: "Insane" },
  { id: 102, name: "Skyfall", creator: "CreatorB", difficulty: "Hard" },
  { id: 103, name: "NeonGate", creator: "CreatorC", difficulty: "Extreme" },
  { id: 104, name: "EasyGrove", creator: "CreatorD", difficulty: "Easy" }
];
const DIFF_ORDER = ["Easy","Medium","Hard","Insane","Extreme"];

/* ----- Storage ----- */
function getPublicRecords(levelId){ return JSON.parse(localStorage.getItem('records_'+levelId)) || []; }
function savePublicRecord(levelId,record){
  const arr=getPublicRecords(levelId); arr.push(record);
  localStorage.setItem('records_'+levelId, JSON.stringify(arr));
}
function getPending(){ return JSON.parse(localStorage.getItem('pending_runs')) || []; }
function savePending(arr){ localStorage.setItem('pending_runs', JSON.stringify(arr)); }
function addPending(levelId,record){
  const p=getPending(); p.push({ levelId, record, ts:Date.now(), id:'p'+Math.random().toString(36).slice(2,9) });
  savePending(p);
}

/* ----- Owner Auth ----- */
const OWNER_CODE="41342";
function isOwner(){ return sessionStorage.getItem('isOwner')==='1'; }
function setOwner(flag){ flag?sessionStorage.setItem('isOwner','1'):sessionStorage.removeItem('isOwner'); updateOwnerUI(); }

/* ----- Render Levels ----- */
const container=document.getElementById('levelsContainer');
function render(){
  container.innerHTML='';
  const sorted=[...levels].sort((a,b)=>DIFF_ORDER.indexOf(a.difficulty)-DIFF_ORDER.indexOf(b.difficulty));
  sorted.forEach(lvl=>{
    const card=document.createElement('div');
    card.className='card';
    card.innerHTML=`
      <div class="level-head">
        <div>
          <div style="font-weight:800">${lvl.name}</div>
          <div class="muted">Creator: ${lvl.creator}</div>
        </div>
        <div>
          <div class="difficulty ${lvl.difficulty}">${lvl.difficulty}</div>
          <div class="muted" style="margin-top:6px">ID: ${lvl.id}</div>
        </div>
      </div>
      <div class="records">
        <div style="margin-top:10px">
          <input type="text" id="name_${lvl.id}" placeholder="Name">
          <input type="number" id="progress_${lvl.id}" placeholder="%" min="0" max="100">
          <input type="number" id="attempts_${lvl.id}" placeholder="Attempts" min="1">
          <button onclick="handleSubmit(${lvl.id})">Einreichen</button>
        </div>
        <h4 style="margin-top:12px">Ã–ffentliche Rekorde (<span id="pubcount_${lvl.id}">0</span>)</h4>
        <ul id="records_${lvl.id}"></ul>
      </div>`;
    container.appendChild(card);
    renderPublicRecords(lvl.id);
  });
}
function renderPublicRecords(levelId){
  const ul=document.getElementById('records_'+levelId);
  const recs=getPublicRecords(levelId); ul.innerHTML='';
  recs.forEach(r=>{
    const li=document.createElement('li');
    li.className='record';
    li.innerHTML=`<div>${escapeHTML(r.name)} â€” ${r.progress}% in ${r.attempts} tries</div><div class="muted">${new Date(r.ts).toLocaleString()}</div>`;
    ul.appendChild(li);
  });
  document.getElementById('pubcount_'+levelId).textContent=recs.length;
}

/* ----- Submit Handler (geht in Pending) ----- */
function handleSubmit(levelId){
  const name=document.getElementById('name_'+levelId).value.trim();
  const progress=document.getElementById('progress_'+levelId).value;
  const attempts=document.getElementById('attempts_'+levelId).value;
  if(!name||progress===''||attempts===''){alert('Bitte alles ausfÃ¼llen.');return;}
  addPending(levelId,{name,progress:Number(progress),attempts:Number(attempts),ts:Date.now()});
  alert('Run eingereicht â€” wartet auf Owner-Approval.');
  document.getElementById('name_'+levelId).value='';
  document.getElementById('progress_'+levelId).value='';
  document.getElementById('attempts_'+levelId).value='';
  renderPendingList();
}

/* ----- Pending / Owner Panel ----- */
function renderPendingList(){
  const list=document.getElementById('pendingList'); const pending=getPending();
  if(!isOwner()){ list.innerHTML='<div class="muted">Nicht im Owner-Mode.</div>'; return; }
  if(pending.length===0){ list.innerHTML='<div class="muted">Keine Pending-Runs.</div>'; return; }
  list.innerHTML='';
  pending.forEach(item=>{
    const lvl=levels.find(x=>x.id===item.levelId)||{name:'Unbekannt'};
    const div=document.createElement('div');
    div.className='record';
    div.innerHTML=`<div>${escapeHTML(lvl.name)}: ${escapeHTML(item.record.name)} â€” ${item.record.progress}% in ${item.record.attempts} tries</div>`;
    const btns=document.createElement('div');
    const approve=document.createElement('button'); approve.textContent='Approve'; approve.className='smallbtn approve';
    approve.onclick=()=>{ approvePending(item.id); };
    const reject=document.createElement('button'); reject.textContent='Reject'; reject.className='smallbtn reject';
    reject.onclick=()=>{ rejectPending(item.id); };
    btns.appendChild(approve); btns.appendChild(reject);
    div.appendChild(btns);
    list.appendChild(div);
  });
}
function approvePending(pid){
  let p=getPending(); const idx=p.findIndex(x=>x.id===pid); if(idx===-1)return;
  savePublicRecord(p[idx].levelId,{...p[idx].record,ts:Date.now()});
  p.splice(idx,1); savePending(p); renderPendingList(); renderPublicRecords(p[idx]?.levelId||0);
}
function rejectPending(pid){
  let p=getPending(); const idx=p.findIndex(x=>x.id===pid); if(idx===-1)return;
  p.splice(idx,1); savePending(p); renderPendingList();
}

/* ----- Login UI ----- */
const loginBtn=document.getElementById('ownerLoginBtn');
const logoutBtn=document.getElementById('ownerLogoutBtn');
const codeInput=document.getElementById('ownerCodeInput');
const badge=document.getElementById('ownerBadge');
loginBtn.onclick=()=>{ if(codeInput.value.trim()===OWNER_CODE){setOwner(true);alert('Owner-Login erfolgreich!');}else alert('Falscher Code.'); };
logoutBtn.onclick=()=>{ setOwner(false); alert('Owner-Logout.'); };
function updateOwnerUI(){
  if(isOwner()){ badge.style.display='inline-block'; logoutBtn.style.display='inline-block'; loginBtn.style.display='none'; codeInput.style.display='none'; document.getElementById('ownerPanel').style.display='block'; }
  else{ badge.style.display='none'; logoutBtn.style.display='none'; loginBtn.style.display='inline-block'; codeInput.style.display='inline-block'; document.getElementById('ownerPanel').style.display='none'; }
  renderPendingList();
}

/* ----- Helpers ----- */
function escapeHTML(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

/* ----- Init ----- */
render(); updateOwnerUI(); renderPendingList();
</script>
</body>
</html>
